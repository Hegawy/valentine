<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Pasant & Yusuf ğŸ’˜</title>

<!-- helps Safari stop being annoying with cache -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
  :root{
    --pink:#ff3b7a;
    --pink2:#ff6aa2;
    --card: rgba(255,255,255,0.92);
    --shadow: 0 18px 60px rgba(0,0,0,0.35);

    /* mobile-first sizing (iPhone 13 friendly) */
    --cardW: min(92vw, 640px);
    --envW:  min(92vw, 560px);

    --sideSize: 96px;
    --coupleW: min(78vw, 420px);
    --coupleH: 240px; /* taller couple frame */
  }

  *{ box-sizing:border-box; }
  html, body{ height:100%; }
  body{
    margin:0;
    overflow:hidden;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:#000;
    color:#111;
  }

  /* ===== Background slideshow ===== */
  .bg{
    position:fixed; inset:0; z-index:-5;
    background-size:cover; background-position:center;
    filter: blur(2px) saturate(1.12);
    transform: scale(1.06);
    transition: opacity 1.2s ease;
    opacity:1;
  }
  .bg::after{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 20% 10%, rgba(255,59,122,0.22), transparent 45%),
      radial-gradient(circle at 80% 30%, rgba(255,106,162,0.18), transparent 55%),
      rgba(0,0,0,0.46);
  }

  /* ===== Confetti ===== */
  #confettiCanvas{
    position:fixed; inset:0;
    width:100vw; height:100vh;
    pointer-events:none;
    z-index:9999;
  }

  /* ===== Stage ===== */
  .stage{
    position:fixed;
    inset:0;
    padding:
      calc(14px + env(safe-area-inset-top))
      calc(14px + env(safe-area-inset-right))
      calc(14px + env(safe-area-inset-bottom))
      calc(14px + env(safe-area-inset-left));
  }

  /* screens are centered absolutely (prevents side-by-side bug on iPhone) */
  .centerScreen{
    position:absolute;
    left:50%;
    top:50%;
    transform: translate(-50%, -50%);
    width: min(92vw, 680px);
    display:flex;
    justify-content:center;
    align-items:center;
  }

  /* ===== Decorative floating hearts (not empty) ===== */
  .floatHearts{
    position:absolute;
    inset:-30px;
    pointer-events:none;
    z-index:1;
    opacity:0.9;
  }
  .heart{
    position:absolute;
    font-size: 18px;
    opacity: .55;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
    animation: drift 6s ease-in-out infinite;
  }
  .heart.big{ font-size: 26px; opacity:.45; }
  .heart.small{ font-size: 14px; opacity:.6; }

  @keyframes drift{
    0%,100%{ transform: translateY(0) rotate(0deg); }
    50%{ transform: translateY(-14px) rotate(8deg); }
  }

  /* ===== Envelope ===== */
  .envelopeWrap{
    width: var(--envW);
    transition: opacity .55s ease, transform .55s ease;
    position:relative;
    z-index:2;
  }

  .envelope{
    width: var(--envW);
    height: min(64vh, 380px);
    max-height: 400px;
    position:relative;
    border-radius: 30px;
    box-shadow: var(--shadow);
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(10px);
    overflow:hidden;
    border: 1px solid rgba(255,255,255,0.55);
  }

  /* glow */
  .envelope::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(circle at 30% 20%, rgba(255,59,122,0.40), transparent 45%),
      radial-gradient(circle at 80% 70%, rgba(255,106,162,0.28), transparent 55%);
    opacity:0.55;
    filter: blur(10px);
    z-index:0;
    pointer-events:none;
  }

  .envInner{ position:absolute; inset:0; z-index:1; }

  .envBase{
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 20% 20%, rgba(255,59,122,0.14), transparent 45%),
      radial-gradient(circle at 80% 60%, rgba(255,106,162,0.12), transparent 55%),
      rgba(255,255,255,0.92);
  }

  .envFlap{
    position:absolute; left:0; right:0; top:0;
    height: 58%;
    background: linear-gradient(135deg, rgba(255,59,122,0.14), rgba(255,106,162,0.10));
    clip-path: polygon(0 0, 100% 0, 50% 82%);
    transform-origin: top;
    transition: transform .9s cubic-bezier(.2,.85,.2,1);
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }
  .envFoldL, .envFoldR{
    position:absolute; bottom:0;
    width:55%; height:62%;
    background: rgba(0,0,0,0.02);
  }
  .envFoldL{ left:-5%; clip-path: polygon(0 100%, 100% 100%, 55% 0); }
  .envFoldR{ right:-5%; clip-path: polygon(0 100%, 100% 100%, 45% 0); }

  .seal{
    position:absolute;
    left:50%;
    bottom: 52px;
    transform: translateX(-50%);
    width: 70px;
    height: 70px;
    border-radius: 18px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-weight:900;
    background: linear-gradient(135deg, var(--pink), var(--pink2));
    box-shadow: 0 18px 34px rgba(255,59,122,0.28);
    user-select:none;
  }

  .letter{
    position:absolute;
    left:50%;
    bottom: 16px;
    transform: translateX(-50%);
    width: 90%;
    height: 76%;
    border-radius: 22px;
    background: rgba(255,255,255,0.96);
    box-shadow: 0 14px 30px rgba(0,0,0,0.18);
    border: 1px solid rgba(0,0,0,0.06);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding: 18px;
    transition: transform .9s cubic-bezier(.2,.85,.2,1), opacity .6s ease;
  }

  .openMe{
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    justify-content:center;
  }
  .openTitle{ margin:0; font-size: 28px; letter-spacing:-0.2px; }
  .openSub{ margin:0; opacity:.85; font-size: 14px; }
  .tapHint{ font-size:12px; opacity:.7; }

  .openBtn{
    margin-top: 8px;
    border:0;
    padding: 12px 18px;
    border-radius: 16px;
    cursor:pointer;
    color:#fff;
    font-weight:900;
    background: linear-gradient(135deg, var(--pink), var(--pink2));
    box-shadow: 0 16px 30px rgba(255,59,122,0.28);
    position:relative;
    overflow:hidden;
    transition: transform .15s ease, filter .15s ease;
  }
  .openBtn::after{
    content:"";
    position:absolute;
    top:-35%;
    left:-70%;
    width:60%;
    height:180%;
    background: rgba(255,255,255,0.22);
    transform: rotate(18deg);
    transition: left .6s ease;
  }
  .openBtn:hover{ transform: translateY(-2px) scale(1.02); filter: brightness(1.03); }
  .openBtn:hover::after{ left:130%; }
  .openBtn:active{ transform: translateY(0) scale(0.99); }

  .envelope.idle{ animation: floaty 2.6s ease-in-out infinite; }
  @keyframes floaty{
    0%,100%{ transform: translateY(0); }
    50%{ transform: translateY(-6px); }
  }

  .opened .envFlap{ transform: rotateX(180deg); }
  .opened .letter{ transform: translateX(-50%) translateY(-190px) scale(1.04); }
  .opened .seal{ opacity:0; transform: translateX(-50%) scale(0.85); transition: .35s ease; }

  /* ===== Card ===== */
  .card{
    width: var(--cardW);
    background: var(--card);
    border-radius: 28px;
    box-shadow: var(--shadow);
    padding: 20px 16px 16px;
    border: 1px solid rgba(255,255,255,0.55);
    backdrop-filter: blur(10px);
    max-height: 88vh;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    position:relative;
    z-index:2;

    opacity:0;
    transform: translateY(18px) scale(0.98);
    transition: opacity .65s ease, transform .65s ease;
  }
  .card.show{
    opacity:1;
    transform: translateY(0) scale(1);
  }

  /* card glow + subtle icons inside */
  .card::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(circle at 30% 18%, rgba(255,59,122,0.30), transparent 45%),
      radial-gradient(circle at 80% 70%, rgba(255,106,162,0.22), transparent 55%);
    opacity:0.6;
    z-index:0;
  }
  .card::after{
    /* faint heart pattern */
    content:"";
    position:absolute; inset:0;
    background-image:
      radial-gradient(circle, rgba(255,59,122,0.10) 1px, transparent 1.6px);
    background-size: 22px 22px;
    opacity:0.22;
    z-index:0;
    pointer-events:none;
  }
  .card > *{ position:relative; z-index:1; }

  /* Photos */
  .topPhotos{
    position:relative;
    height: calc(var(--coupleH) + 18px);
    margin-bottom: 8px;
  }
  .pfpFrame{
    width: var(--sideSize);
    height: var(--sideSize);
    border-radius: 26px;
    overflow:hidden;
    border: 3px solid rgba(255,255,255,0.92);
    box-shadow: 0 18px 34px rgba(0,0,0,0.22);
    background:#ddd;
    position:absolute;
    top:0;
    transition: transform .35s ease, filter .35s ease, opacity .35s ease;
  }
  .pfpFrame img{ width:100%; height:100%; object-fit:cover; display:block; }
  #pasantFrame{ left:0; }
  #yusufFrame{ right:0; }

  .coupleFrame{
    position:absolute;
    left:50%; top:0;
    transform: translateX(-50%) scale(0.82);
    width: var(--coupleW);
    height: var(--coupleH);
    border-radius: 32px;
    overflow:hidden;
    border: 3px solid rgba(255,255,255,0.94);
    box-shadow: 0 20px 40px rgba(0,0,0,0.24);
    opacity:0;
    filter: blur(2px);
    transition: opacity .55s ease, transform .55s ease, filter .55s ease;
    background:#ddd;
  }
  .coupleFrame img{ width:100%; height:100%; object-fit:cover; display:block; }

  .merged #pasantFrame,
  .merged #yusufFrame{
    opacity:0;
    transform: scale(0.65) translateY(10px);
    filter: blur(2px);
    pointer-events:none;
  }
  .merged #coupleFrame{
    opacity:1;
    filter: blur(0);
    transform: translateX(-50%) scale(1);
    animation: pop .55s ease;
  }
  @keyframes pop{
    0%{ transform: translateX(-50%) scale(0.82); }
    60%{ transform: translateX(-50%) scale(1.06); }
    100%{ transform: translateX(-50%) scale(1.0); }
  }

  h1{
    margin: 8px 0 0;
    font-size: clamp(22px, 5.8vw, 30px);
    line-height: 1.15;
    letter-spacing:-0.2px;
    text-align:center;
  }
  .sub{
    margin: 8px 0 0;
    opacity:.78;
    font-size:14px;
    text-align:center;
  }
  .question{
    margin: 12px 0 14px;
    font-size: 17px;
    opacity:.92;
    text-align:center;
  }

  /* Buttons */
  .btnRow{
    position:relative;
    height: 82px;
    margin-top: 6px;
    display:flex;
    justify-content:center;
    align-items:flex-start;
  }
  .btn{
    border:0;
    padding: 14px 22px;
    border-radius: 18px;
    font-size: 16px;
    cursor:pointer;
    user-select:none;
    transition: transform .16s ease, filter .16s ease, box-shadow .16s ease;
    will-change: transform;
  }
  .btn:active{ transform: translateY(1px) scale(0.99); }

  /* YES button shine (back!) */
  #yes{
    background: linear-gradient(135deg, var(--pink), var(--pink2));
    color:#fff;
    font-weight: 900;
    box-shadow: 0 16px 32px rgba(255,59,122,0.28);
    position:relative;
    overflow:hidden;
  }
  #yes::after{
    content:"";
    position:absolute;
    top:-35%;
    left:-65%;
    width: 60%;
    height: 180%;
    background: rgba(255,255,255,0.22);
    transform: rotate(18deg);
    transition: left .6s ease;
  }
  #yes:hover{
    transform: translateY(-2px) scale(1.02);
    filter: brightness(1.03);
    box-shadow: 0 20px 42px rgba(255,59,122,0.33);
  }
  #yes:hover::after{ left:125%; }
  #yes.pulsing{ animation: pulse 1.35s ease-in-out infinite; }
  @keyframes pulse{
    0%,100%{ transform: translateY(0) scale(1); }
    50%{ transform: translateY(-1px) scale(1.03); }
  }

  /* NO button small (no scaling) */
  #no{
    position:absolute;
    padding: 10px 14px;
    border-radius: 14px;
    font-size: 14px;
    background: #15151a;
    color:#fff;
    box-shadow: 0 14px 26px rgba(0,0,0,0.25);
    width:auto;
    transform: none !important;
  }

  .yay{
    display:none;
    margin-top: 12px;
    padding: 14px;
    border-radius: 18px;
    background: rgba(255, 235, 243, 0.92);
    border: 1px solid rgba(255, 59, 122, 0.22);
    font-size: 16px;
    line-height: 1.45;
    text-align:center;
  }

  /* iPhone tighten */
  @media (max-width: 430px){
    :root{
      --sideSize: 92px;
      --coupleW: min(80vw, 360px);
      --coupleH: 250px; /* taller on iPhone */
    }
  }
</style>
</head>

<body>
  <div class="bg" id="bg"></div>
  <canvas id="confettiCanvas"></canvas>

  <div class="stage">

    <!-- ENVELOPE SCREEN -->
    <div class="centerScreen" id="envelopeScreen">
      <div class="floatHearts" aria-hidden="true">
        <div class="heart big" style="left:8%; top:12%;">ğŸ’—</div>
        <div class="heart" style="left:14%; top:72%; animation-delay:.4s;">ğŸ’</div>
        <div class="heart small" style="left:86%; top:18%; animation-delay:.8s;">ğŸ’˜</div>
        <div class="heart" style="left:78%; top:78%; animation-delay:1.2s;">ğŸ’–</div>
        <div class="heart small" style="left:50%; top:6%; animation-delay:1.6s;">ğŸŒ¹</div>
      </div>

      <div class="envelopeWrap" id="envelopeWrap">
        <div class="envelope idle" id="envelope">
          <div class="envInner">
            <div class="envBase"></div>
            <div class="envFlap"></div>
            <div class="envFoldL"></div>
            <div class="envFoldR"></div>
            <div class="seal" id="seal">P + Y</div>

            <div class="letter" id="letter">
              <div class="openMe">
                <h2 class="openTitle">ğŸ’Œ Open me</h2>
                <p class="openSub">A message for <b>Pasant</b> from <b>Yusuf</b></p>
                <div class="tapHint">Tap anywhere to open</div>
                <button class="openBtn" id="openBtn">Open</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CARD SCREEN -->
    <div class="centerScreen" id="cardScreen" style="display:none;">
      <div class="floatHearts" aria-hidden="true">
        <div class="heart big" style="left:6%; top:10%;">ğŸ’–</div>
        <div class="heart" style="left:10%; top:82%; animation-delay:.6s;">ğŸ’—</div>
        <div class="heart small" style="left:88%; top:16%; animation-delay:1s;">ğŸ’</div>
        <div class="heart" style="left:82%; top:84%; animation-delay:1.4s;">ğŸ’˜</div>
        <div class="heart small" style="left:52%; top:4%; animation-delay:1.8s;">âœ¨</div>
      </div>

      <div class="card" id="card">
        <div class="topPhotos" id="topPhotos">
          <div class="pfpFrame" id="pasantFrame">
            <img src="images/pasant1.jpeg" alt="Pasant">
          </div>
          <div class="pfpFrame" id="yusufFrame">
            <img src="images/yusuf1.jpeg" alt="Yusuf">
          </div>
          <div class="coupleFrame" id="coupleFrame">
            <img src="images/couple.jpeg" alt="Pasant and Yusuf">
          </div>
        </div>

        <h1 id="title">Will you be my Valentine? ğŸ’˜</h1>
        <div class="sub">Pasantâ€¦ there is only one correct answer ğŸ˜Œ</div>
        <div class="question">Will you be my Valentine, Pasant? ğŸŒ¹</div>

        <div class="btnRow" id="btnRow">
          <button class="btn pulsing" id="yes">Yes ğŸ˜Œ</button>
          <button class="btn" id="no">No ğŸ™‚</button>
        </div>

        <div class="yay" id="yay">
          YAAAAY!! â¤ï¸ğŸ‰<br/>
          <b>Pasant & Yusuf</b> â€” officially Valentines.<br/>
          Remind me today and Iâ€™ll plan something cute for us ğŸŒ¹
        </div>
      </div>
    </div>

  </div>

  <!-- Sounds -->
  <audio id="song" src="song.mp3" preload="auto"></audio>
  <audio id="noSound" src="no.mp3" preload="auto"></audio>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <script>
    /* ===== Background slideshow ===== */
    const bg = document.getElementById("bg");
    const bgImages = ["images/bg1.jpeg","images/bg2.jpeg","images/bg3.jpeg","images/bg4.jpeg"];
    let bgIndex = 0;
    function setBg(i){
      bg.style.opacity = "0";
      setTimeout(() => {
        bg.style.backgroundImage = `url('${bgImages[i]}')`;
        bg.style.opacity = "1";
      }, 450);
    }
    setBg(bgIndex);
    setInterval(() => { bgIndex = (bgIndex + 1) % bgImages.length; setBg(bgIndex); }, 4500);

    /* ===== Confetti (full page, DPR fixed) ===== */
    const canvas = document.getElementById("confettiCanvas");

    function resizeCanvas(){
      const dpr = Math.min(window.devicePixelRatio || 1, 2); // cap for iPhone performance
      canvas.width  = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width  = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";

      // scale drawing to match DPR
      const ctx = canvas.getContext("2d");
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    resizeCanvas();
    window.addEventListener("resize", resizeCanvas, { passive: true });

    // IMPORTANT: use this canvas specifically (no Worker issues on iOS sometimes)
    const myConfetti = confetti.create(canvas, { resize: false, useWorker: false });


    /* ===== Screen switching (no layout bugs) ===== */
    const envelope = document.getElementById("envelope");
    const envelopeScreen = document.getElementById("envelopeScreen");
    const cardScreen = document.getElementById("cardScreen");
    const card = document.getElementById("card");
    const openBtn = document.getElementById("openBtn");

    let opened = false;
    function openEnvelope(){
      if(opened) return;
      opened = true;

      envelope.classList.add("opened");

      setTimeout(() => {
        envelopeScreen.style.display = "none";
        cardScreen.style.display = "flex";
        requestAnimationFrame(() => card.classList.add("show"));
      }, 950);
    }
    openBtn.addEventListener("click", openEnvelope);
    envelope.addEventListener("click", (e) => {
      if (e.target && e.target.id === "openBtn") return;
      openEnvelope();
    });

    /* ===== No button: small + runs away + sound effect ===== */
    const noBtn = document.getElementById("no");
    const btnRow = document.getElementById("btnRow");
    const noSound = document.getElementById("noSound");

    function playNoSound(){
      try{
        noSound.currentTime = 0;
        noSound.play();
      }catch(e){}
    }

    function teleportNo(instant=false){
      playNoSound();

      const rowRect = btnRow.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();
      const pad = 8;

      const maxX = Math.max(0, rowRect.width - btnRect.width - pad);
      const maxY = Math.max(0, rowRect.height - btnRect.height - pad);

      noBtn.style.transition = instant ? "left 0.06s linear, top 0.06s linear" : "left 0.14s ease, top 0.14s ease";
      noBtn.style.left = (pad + Math.random() * maxX) + "px";
      noBtn.style.top  = (pad + Math.random() * maxY) + "px";
    }

    // initial position after card shows
    setTimeout(() => teleportNo(false), 300);

    // iPhone: touchstart is key
    noBtn.addEventListener("click", (e)=>{ e.preventDefault(); teleportNo(true); });
    noBtn.addEventListener("touchstart", (e)=>{ e.preventDefault(); teleportNo(true); }, { passive:false });

    // desktop bonus (hover)
    noBtn.addEventListener("mouseenter", ()=>teleportNo(true));
    noBtn.addEventListener("mousemove", ()=>teleportNo(true));

    /* ===== Yes: merge photos + confetti + PLAY YOUR SONG ===== */
    const yesBtn = document.getElementById("yes");
    const yay = document.getElementById("yay");
    const title = document.getElementById("title");
    const topPhotos = document.getElementById("topPhotos");
    const song = document.getElementById("song");

    yesBtn.addEventListener("click", async () => {
      title.textContent = "Pasant & Yusuf ğŸ’˜";
      topPhotos.classList.add("merged");

      yay.style.display = "block";
      yesBtn.classList.remove("pulsing");
      yesBtn.textContent = "Locked in âœ…";
      yesBtn.disabled = true;

      noBtn.style.display = "none";

      remindsConfetti(3.0);

      // iPhone allows audio only after user gesture -> this is perfect
      try{
        song.currentTime = 0;
        await song.play();
      }catch(e){}
    });
  </script>
</body>
</html>
