<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Pasant & Yusuf üíò</title>

<style>
  :root{
    --pink:#ff3b7a;
    --pink2:#ff6aa2;
    --card: rgba(255,255,255,0.92);
    --shadow: 0 18px 60px rgba(0,0,0,0.35);

    /* Responsive sizes (mobile-first) */
    --cardW: min(92vw, 640px);
    --envW:  min(92vw, 560px);

    --sideSize: 120px;              /* side frames default */
    --sideRadius: 26px;

    --coupleW: min(70vw, 420px);    /* center frame width */
    --coupleH: 190px;               /* BIGGER height (your request) */
    --coupleRadius: 30px;
  }

  *{ box-sizing:border-box; }
  html, body{ height:100%; }
  body{
    margin:0; overflow:hidden;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:#000; color:#111;
  }

  /* ===== Background slideshow ===== */
  .bg{
    position:fixed; inset:0; z-index:-3;
    background-size:cover; background-position:center;
    filter: blur(2px) saturate(1.1);
    transform: scale(1.05);
    transition: opacity 1.2s ease-in-out;
    opacity: 1;
  }
  .bg::after{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 20% 10%, rgba(255,59,122,0.22), transparent 45%),
      radial-gradient(circle at 80% 30%, rgba(255,106,162,0.18), transparent 55%),
      rgba(0,0,0,0.42);
  }

  /* Full page confetti canvas */
  #confettiCanvas{
    position:fixed; inset:0;
    width:100vw; height:100vh;
    pointer-events:none;
    z-index:9999;
  }

  /* ===== Stage layout (center, safe-area aware) ===== */
  .stage{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:
      calc(14px + env(safe-area-inset-top))
      calc(14px + env(safe-area-inset-right))
      calc(14px + env(safe-area-inset-bottom))
      calc(14px + env(safe-area-inset-left));
  }

  /* =========================
     ENVELOPE INTRO (responsive)
  ========================== */
  .envelopeWrap{
    width: var(--envW);
    display:flex;
    align-items:center;
    justify-content:center;
    transition: opacity .55s ease, transform .55s ease;
  }

  .envelope{
    width: var(--envW);
    height: min(64vh, 380px); /* fits iPhone */
    max-height: 400px;
    position:relative;
    border-radius: 28px;
    box-shadow: var(--shadow);
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(10px);
    overflow:hidden;
    border: 1px solid rgba(255,255,255,0.55);
    transform: translateZ(0);
  }

  .envelopeGlow{
    position:absolute; inset:-2px;
    background:
      radial-gradient(circle at 30% 20%, rgba(255,59,122,0.38), transparent 45%),
      radial-gradient(circle at 80% 70%, rgba(255,106,162,0.25), transparent 55%);
    opacity:0.55;
    filter: blur(10px);
    z-index:0;
    pointer-events:none;
  }

  .envelopeInner{ position:absolute; inset:0; z-index:1; }

  .envBase{
    position:absolute; inset:0;
    background:
      radial-gradient(circle at 20% 20%, rgba(255,59,122,0.14), transparent 45%),
      radial-gradient(circle at 80% 60%, rgba(255,106,162,0.12), transparent 55%),
      rgba(255,255,255,0.92);
  }

  .envFlap{
    position:absolute; left:0; right:0; top:0;
    height: 58%;
    background: linear-gradient(135deg, rgba(255,59,122,0.14), rgba(255,106,162,0.10));
    clip-path: polygon(0 0, 100% 0, 50% 82%);
    transform-origin: top;
    transition: transform .9s cubic-bezier(.2,.85,.2,1);
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }

  .envFoldL,.envFoldR{
    position:absolute; bottom:0;
    width:55%; height:62%;
    background: rgba(0,0,0,0.02);
  }
  .envFoldL{
    left:-5%;
    clip-path: polygon(0 100%, 100% 100%, 55% 0);
    border-top: 1px solid rgba(0,0,0,0.05);
  }
  .envFoldR{
    right:-5%;
    clip-path: polygon(0 100%, 100% 100%, 45% 0);
    border-top: 1px solid rgba(0,0,0,0.05);
  }

  .seal{
    position:absolute;
    left:50%;
    bottom: 52px;
    transform: translateX(-50%);
    width: 66px;
    height: 66px;
    border-radius: 18px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-weight:900;
    background: linear-gradient(135deg, var(--pink), var(--pink2));
    box-shadow: 0 18px 34px rgba(255,59,122,0.28);
    z-index:3;
    user-select:none;
  }
  .seal::before{
    content:"";
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.22);
    border-radius: 10px;
    position:absolute;
    transform: rotate(18deg);
    opacity:.9;
  }
  .seal span{ position:relative; z-index:2; letter-spacing:1px; }

  .letter{
    position:absolute;
    left:50%;
    bottom: 16px;
    transform: translateX(-50%);
    width: 90%;
    height: 76%;
    border-radius: 22px;
    background: rgba(255,255,255,0.96);
    box-shadow: 0 14px 30px rgba(0,0,0,0.18);
    border: 1px solid rgba(0,0,0,0.06);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding: 18px;
    transition: transform .9s cubic-bezier(.2,.85,.2,1), opacity .6s ease;
  }

  .openMe{
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    justify-content:center;
    width:100%;
  }

  .openTitle{ font-size: 28px; margin:0; letter-spacing:-0.2px; }
  .openSub{ margin:0; opacity:.85; font-size: 14px; }
  .tapHint{ margin-top: 2px; font-size: 12px; opacity: .7; }

  .openBtn{
    margin-top: 8px;
    border:0;
    padding: 12px 18px;
    border-radius: 16px;
    cursor:pointer;
    color:#fff;
    font-weight:900;
    background: linear-gradient(135deg, var(--pink), var(--pink2));
    box-shadow: 0 16px 30px rgba(255,59,122,0.28);
    transition: transform .15s ease, filter .15s ease;
    position:relative;
    overflow:hidden;
  }
  .openBtn::after{
    content:"";
    position:absolute;
    top:-35%;
    left:-70%;
    width:60%;
    height:180%;
    background: rgba(255,255,255,0.22);
    transform: rotate(18deg);
    transition: left .6s ease;
  }
  .openBtn:hover{ transform: translateY(-2px) scale(1.02); filter: brightness(1.03); }
  .openBtn:hover::after{ left:130%; }
  .openBtn:active{ transform: translateY(0) scale(0.99); }

  .envelope.idle{ animation: floaty 2.6s ease-in-out infinite; }
  @keyframes floaty{ 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-6px);} }
  .envelope:hover{ animation: wiggle 0.22s ease-in-out infinite; }
  @keyframes wiggle{ 0%,100%{ transform: rotate(0deg);} 50%{ transform: rotate(-0.6deg);} }

  .opened .envFlap{ transform: rotateX(180deg); }
  .opened .letter{ transform: translateX(-50%) translateY(-190px) scale(1.04); }
  .opened .seal{ opacity:0; transform: translateX(-50%) scale(0.85); transition: .35s ease; }

  .hideEnvelope{
    opacity:0;
    transform: translateY(16px) scale(0.98);
    pointer-events:none;
  }

  /* =========================
     MAIN VALENTINE CARD
  ========================== */
  .card{
    width: var(--cardW);
    background: var(--card);
    border-radius: 28px;
    box-shadow: var(--shadow);
    padding: 22px 18px 18px;
    position:relative;
    overflow:hidden;
    border: 1px solid rgba(255,255,255,0.55);
    backdrop-filter: blur(10px);
    opacity:0;
    transform: translateY(18px) scale(0.98);
    pointer-events:none;
    transition: opacity .65s ease, transform .65s ease;
  }
  .card.show{
    opacity:1;
    transform: translateY(0) scale(1);
    pointer-events:auto;
  }
  .card::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(circle at 30% 20%, rgba(255,59,122,0.32), transparent 42%),
      radial-gradient(circle at 80% 60%, rgba(255,106,162,0.25), transparent 55%);
    opacity:0.55;
    z-index:0;
  }
  .card > *{ position:relative; z-index:1; }

  /* TOP PHOTO AREA (responsive & iPhone-friendly) */
  .topPhotos{
    position:relative;
    height: calc(var(--coupleH) + 22px);
    margin-bottom: 8px;
  }

  .pfpFrame{
    width: var(--sideSize);
    height: var(--sideSize);
    border-radius: var(--sideRadius);
    overflow:hidden;
    border: 3px solid rgba(255,255,255,0.92);
    box-shadow: 0 18px 34px rgba(0,0,0,0.22);
    background:#ddd;
    position:absolute;
    top: 0;
    transition: transform .35s ease, filter .35s ease, opacity .35s ease;
  }
  .pfpFrame img{ width:100%; height:100%; object-fit:cover; display:block; }
  #pasantFrame{ left:0; }
  #yusufFrame{ right:0; }

  /* BIGGER COUPLE FRAME (taller) */
  .coupleFrame{
    position:absolute;
    left:50%;
    top:0;
    transform: translateX(-50%) scale(0.82);
    width: var(--coupleW);
    height: var(--coupleH);
    border-radius: var(--coupleRadius);
    overflow:hidden;
    border: 3px solid rgba(255,255,255,0.94);
    box-shadow: 0 20px 40px rgba(0,0,0,0.24);
    opacity:0;
    filter: blur(2px);
    transition: opacity .55s ease, transform .55s ease, filter .55s ease;
    background:#ddd;
  }
  .coupleFrame img{ width:100%; height:100%; object-fit:cover; display:block; }

  .merged #pasantFrame,
  .merged #yusufFrame{
    opacity:0;
    transform: scale(0.65) translateY(10px);
    filter: blur(2px);
    pointer-events:none;
  }
  .merged #coupleFrame{
    opacity:1;
    filter: blur(0);
    transform: translateX(-50%) scale(1);
    animation: pop .55s ease;
  }
  @keyframes pop{
    0%{ transform: translateX(-50%) scale(0.82); }
    60%{ transform: translateX(-50%) scale(1.04); }
    100%{ transform: translateX(-50%) scale(1.0); }
  }

  h1{
    margin: 6px 0 0;
    font-size: clamp(22px, 5.8vw, 30px);
    line-height: 1.15;
    letter-spacing:-0.2px;
    text-align:center;
  }
  .sub{
    margin: 8px 0 0;
    opacity:.78;
    font-size: 14px;
    text-align:center;
  }
  .question{
    margin: 12px 0 14px;
    font-size: 17px;
    opacity:.92;
    text-align:center;
  }

  .btnRow{
    position:relative;
    height: 82px;
    margin-top: 4px;
    display:flex;
    justify-content:center;
    align-items:flex-start;
  }

  .btn{
    border:0;
    padding: 14px 22px;
    border-radius: 18px;
    font-size: 16px;
    cursor:pointer;
    user-select:none;
    transition: transform .16s ease, filter .16s ease, box-shadow .16s ease;
    will-change: transform;
  }
  .btn:active{ transform: translateY(1px) scale(0.99); }

  #yes{
    background: linear-gradient(135deg, var(--pink), var(--pink2));
    color:#fff;
    font-weight: 900;
    box-shadow: 0 16px 32px rgba(255,59,122,0.28);
    position:relative;
    overflow:hidden;
  }
  #yes::after{
    content:"";
    position:absolute;
    top:-35%;
    left:-65%;
    width: 60%;
    height: 180%;
    background: rgba(255,255,255,0.22);
    transform: rotate(18deg);
    transition: left .6s ease;
  }
  #yes:hover{ transform: translateY(-2px) scale(1.02); filter: brightness(1.03); }
  #yes:hover::after{ left:125%; }
  #yes.pulsing{ animation: pulse 1.35s ease-in-out infinite; }
  @keyframes pulse{
    0%,100%{ transform: translateY(0) scale(1); }
    50%{ transform: translateY(-1px) scale(1.03); }
  }

  /* NO button: small & fixed */
  #no{
    position:absolute;
    padding: 10px 14px;
    border-radius: 14px;
    font-size: 14px;
    background: #15151a;
    color:#fff;
    box-shadow: 0 14px 26px rgba(0,0,0,0.25);
    width: auto;
    transform: none !important;
    -webkit-text-size-adjust: 100%;
  }

  .yay{
    display:none;
    margin-top: 12px;
    padding: 14px 14px;
    border-radius: 18px;
    background: rgba(255, 235, 243, 0.92);
    border: 1px solid rgba(255, 59, 122, 0.22);
    font-size: 16px;
    line-height: 1.45;
    text-align:center;
  }

  .spotify{
    margin-top: 12px;
    border-radius: 16px;
    overflow:hidden;
    border: 1px solid rgba(0,0,0,0.08);
  }

  .tiny{
    margin-top:10px;
    font-size:12px;
    opacity:.75;
    text-align:center;
  }

  /* ===== iPhone / small screens adjustments ===== */
  @media (max-width: 430px){
    :root{
      --sideSize: 104px;     /* prevent overlap on iPhone */
      --coupleW:  min(74vw, 360px);
      --coupleH:  210px;     /* even taller on iPhone */
      --coupleRadius: 28px;
    }
    .topPhotos{
      height: calc(var(--coupleH) + 18px);
    }
  }

  /* very small phones */
  @media (max-width: 360px){
    :root{
      --sideSize: 96px;
      --coupleW:  min(76vw, 330px);
      --coupleH:  200px;
    }
  }
</style>
</head>

<body>
  <div class="bg" id="bg"></div>
  <canvas id="confettiCanvas"></canvas>

  <div class="stage">
    <!-- ENVELOPE -->
    <div class="envelopeWrap" id="envelopeWrap">
      <div class="envelope idle" id="envelope">
        <div class="envelopeGlow"></div>

        <div class="envelopeInner">
          <div class="envBase"></div>
          <div class="envFlap"></div>
          <div class="envFoldL"></div>
          <div class="envFoldR"></div>

          <div class="seal" id="seal"><span>P + Y</span></div>

          <div class="letter" id="letter">
            <div class="openMe">
              <h2 class="openTitle">üíå Open me</h2>
              <p class="openSub">A message for <b>Pasant</b> from <b>Yusuf</b></p>
              <div class="tapHint">Tap anywhere to open</div>
              <button class="openBtn" id="openBtn">Open</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MAIN CARD -->
    <div class="card" id="card">
      <div class="topPhotos" id="topPhotos">
        <div class="pfpFrame" id="pasantFrame">
          <img src="images/pasant1.jpeg" alt="Pasant">
        </div>
        <div class="pfpFrame" id="yusufFrame">
          <img src="images/yusuf1.jpeg" alt="Yusuf">
        </div>

        <div class="coupleFrame" id="coupleFrame">
          <img src="images/couple.jpeg" alt="Pasant and Yusuf">
        </div>
      </div>

      <h1 id="title">Will you be my Valentine? üíò</h1>
      <div class="sub">Pasant‚Ä¶ there is only one correct answer üòå</div>
      <div class="question">Will you be my Valentine, Pasant? üåπ</div>

      <div class="btnRow" id="btnRow">
        <button class="btn pulsing" id="yes">Yes üòå</button>
        <button class="btn" id="no">No üôÇ</button>
      </div>

      <div class="yay" id="yay">
        YAAAAY!! ‚ù§Ô∏èüéâ<br/>
        <b>Pasant & Yusuf</b> ‚Äî officially Valentines.<br/>
        Text me: <b>"YES Valentine"</b> üòÑ
      </div>

      <div class="spotify">
        <iframe
          style="border-radius:16px"
          src="https://open.spotify.com/embed/track/7qiZfU4dY1lWllzX7mPBI3?utm_source=generator"
          width="100%"
          height="152"
          frameBorder="0"
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
          loading="lazy"></iframe>
      </div>

      <div class="tiny">
        Optional: add <b>song.mp3</b> in repo root to play audio after clicking ‚ÄúYes‚Äù.
      </div>

      <audio id="song" src="song.mp3" preload="auto"></audio>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <script>
    /* ===== Background slideshow ===== */
    const bg = document.getElementById("bg");
    const bgImages = ["images/bg1.jpeg","images/bg2.jpeg","images/bg3.jpeg","images/bg4.jpeg"];
    let bgIndex = 0;
    function setBg(i){
      bg.style.opacity = "0";
      setTimeout(() => {
        bg.style.backgroundImage = `url('${bgImages[i]}')`;
        bg.style.opacity = "1";
      }, 450);
    }
    setBg(bgIndex);
    setInterval(() => { bgIndex = (bgIndex + 1) % bgImages.length; setBg(bgIndex); }, 4500);

    /* ===== Confetti full-page (FIXED on iPhone) ===== */
    const canvas = document.getElementById("confettiCanvas");
    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    const myConfetti = confetti.create(canvas, { resize: false, useWorker: true });

    function fullPageConfetti(seconds = 2.8){
      const end = Date.now() + seconds * 1000;
      (function frame(){
        myConfetti({
          particleCount: 32,
          spread: 150,
          startVelocity: 38,
          scalar: 1.05,
          origin: { x: Math.random(), y: Math.random() * 0.95 }
        });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }

    /* ===== Envelope open -> reveal card ===== */
    const openBtn = document.getElementById("openBtn");
    const envelope = document.getElementById("envelope");
    const envelopeWrap = document.getElementById("envelopeWrap");
    const card = document.getElementById("card");

    let opened = false;
    function openEnvelope(){
      if (opened) return;
      opened = true;
      envelope.classList.add("opened");
      setTimeout(() => {
        envelopeWrap.classList.add("hideEnvelope");
        card.classList.add("show");
      }, 950);
    }

    openBtn.addEventListener("click", openEnvelope);
    envelope.addEventListener("click", (e) => {
      if (e.target && e.target.id === "openBtn") return;
      openEnvelope();
    });

    /* ===== No button: small & stays inside the row ===== */
    const noBtn = document.getElementById("no");
    const btnRow = document.getElementById("btnRow");
    noBtn.style.position = "absolute";

    function teleportNo(instant=false){
      const rowRect = btnRow.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();
      const pad = 8;

      const maxX = Math.max(0, rowRect.width - btnRect.width - pad);
      const maxY = Math.max(0, rowRect.height - btnRect.height - pad);

      const x = pad + Math.random() * maxX;
      const y = pad + Math.random() * maxY;

      noBtn.style.transition = instant ? "left 0.06s linear, top 0.06s linear" : "left 0.14s ease, top 0.14s ease";
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
    }

    setTimeout(() => teleportNo(false), 260);

    // On iPhone there‚Äôs no hover, so we use touchstart too
    noBtn.addEventListener("mouseenter", () => teleportNo(true));
    noBtn.addEventListener("mousemove", () => teleportNo(true));
    noBtn.addEventListener("click", (e) => { e.preventDefault(); teleportNo(true); });
    noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); teleportNo(true); }, { passive:false });

    // Near-cursor (desktop) ‚Äî harmless on iPhone
    document.addEventListener("mousemove", (e) => {
      if (!card.classList.contains("show")) return;
      if (noBtn.style.display === "none") return;
      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width/2, cy = r.top + r.height/2;
      const dist = Math.hypot(e.clientX - cx, e.clientY - cy);
      if (dist < 95) teleportNo(true);
    });

    /* ===== Yes action ===== */
    const yesBtn = document.getElementById("yes");
    const yay = document.getElementById("yay");
    const title = document.getElementById("title");
    const topPhotos = document.getElementById("topPhotos");
    const song = document.getElementById("song");

    yesBtn.addEventListener("click", async () => {
      yay.style.display = "block";
      title.textContent = "Pasant & Yusuf üíò";
      topPhotos.classList.add("merged");
      yesBtn.classList.remove("pulsing");
      yesBtn.textContent = "Locked in ‚úÖ";
      yesBtn.disabled = true;
      noBtn.style.display = "none";

      fullPageConfetti(2.8);

      try{ await song.play(); }catch(e){}
    });
  </script>
</body>
</html>
